<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lightrunner</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
html,body{margin:0;padding:0;overflow:hidden;height:100%;background:black;font-family:'Share Tech Mono', monospace;}
canvas{display:block;}
#menu{
  position:absolute;top:0;left:0;width:100%;height:100%;
  display:flex;flex-direction:column;justify-content:center;align-items:center;
  background: rgba(0,0,0,0.85); z-index:10;color:white;
}
#menu input,#menu select,#menu button{
  margin:8px;padding:12px;font-size:18px;
  background:#111;border:2px solid cyan;color:white;border-radius:6px;
  text-shadow:0 0 5px cyan;
  cursor:pointer;transition:0.2s;
}
#menu input:focus,#menu select:focus,#menu button:hover{
  border-color:#0ff;text-shadow:0 0 10px #0ff;outline:none;
}
#title{
  font-size:72px;color:cyan;font-weight:bold;
  animation:bob 1.5s infinite alternate;
  margin-bottom:20px;
  text-shadow:0 0 15px cyan,0 0 30px cyan;
}
@keyframes bob{0%{transform:translateY(0px);}100%{transform:translateY(20px);}}
#hud{position:absolute;top:10px;left:10px;color:white;font-weight:bold;font-size:20px;z-index:5;}
</style>
</head>
<body>
<div id="menu">
  <div id="title">Lightrunner</div>
  <input id="playerName" placeholder="Enter your name" maxlength="12"/>
  <select id="bikeColor">
    <option value="cyan">Cyan</option>
    <option value="magenta">Magenta</option>
    <option value="yellow">Yellow</option>
    <option value="lime">Lime</option>
    <option value="blue">Blue</option>
    <option value="red">Red</option>
    <option value="green">Green</option>
  </select>
  <button id="startBtn">Run!</button>
  <div style="margin-top:10px;font-size:14px;opacity:0.8;">
    Controls: WASD to move, Space to jump
  </div>
</div>
<div id="hud"></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let width=canvas.width=window.innerWidth;
let height=canvas.height=window.innerHeight;
const hud=document.getElementById('hud');

let gameRunning=false;
let distance=0,score=0;
const GRAVITY=0.5;
const PLAYER_SPEED=6, BOT_BASE_SPEED=4;
const TILE_SIZE=200, TILE_LOOKAHEAD=8;

let player,bots=[],trails=[],tiles=[],discs=[];
let keys={w:false,a:false,s:false,d:false,space:false};

// --- Classes ---
class Bike{
  constructor(x,y,color,name,isBot=false){
    this.x=x; this.y=y; this.z=0; this.color=color; this.name=name;
    this.isBot=isBot; this.alive=true; this.ammo=0; this.vy=0; this.onGround=true;
    this.boost=0;
    this.trail=[];
  }
  move(){
    if(!this.alive)return;

    // Boost
    let speed=PLAYER_SPEED;
    if(this.boost>0){speed*=1.8; this.boost--; ctx.shadowBlur=20; ctx.shadowColor='white';}

    // Gravity & jump
    this.z+=this.vy; this.vy+=GRAVITY;
    if(this.z>=0){this.z=0; this.vy=0; this.onGround=true;}else this.onGround=false;

    // Input / AI
    if(!this.isBot){
      if(keys.w)this.y-=speed;
      if(keys.s)this.y+=speed;
      if(keys.a)this.x-=speed;
      if(keys.d)this.x+=speed;
      if(keys.space && this.onGround){this.vy=-12; this.onGround=false; keys.space=false;}
    }else{
      if(player){
        let dx=player.x-this.x,dy=player.y-this.y;
        let s=BOT_BASE_SPEED+(distance/500);
        if(this.boost>0)s*=1.5;
        this.x+=Math.sign(dx)*Math.min(Math.abs(dx),s*0.5);
        this.y+=Math.sign(dy)*Math.min(Math.abs(dy),s);
        if(this.onGround && Math.random()<0.01)this.vy=-10;
      }
    }

    // Trail & collision
    this.trail.push({x:this.x,y:this.y,z:this.z});
    if(this.trail.length>150)this.trail.shift();
    trails.push({x:this.x,y:this.y,z:this.z,color:this.color});
    if(trails.length>2000)trails.shift();

    this.checkCollision();
  }
  checkCollision(){
    // Trail collision
    for(let t of trails){
      if(t===this)continue;
      if(Math.abs(this.x-t.x)<15 && Math.abs(this.y-t.y)<15 && Math.abs(this.z-t.z)<10){
        this.alive=false;
        return;
      }
    }
    // Tile boost
    for(let t of tiles){
      if(this.y>t.y && this.y<t.y+t.height){
        if(t.isBoost){this.boost=10;}
      }
    }
  }
  draw(cameraX,cameraY,cameraZ){
    if(!this.alive)return;
    let tiltX = (this.x - player.x)/width*20;
    let screenX = this.x - cameraX - tiltX;
    let screenY = this.y - cameraY - this.z + cameraZ;
    ctx.shadowBlur=15; ctx.shadowColor=this.color;
    ctx.fillStyle=this.color;
    ctx.fillRect(screenX-15,screenY-30,30,60);
    ctx.shadowBlur=0;
  }
}

class Tile{
  constructor(type){
    this.type=type;
    this.y=tiles.length*TILE_SIZE;
    this.height=TILE_SIZE;
    this.isBoost=Math.random()<0.2;
  }
  draw(cameraY,cameraZ){
    let screenY = this.y - cameraY - cameraZ;
    if(screenY+this.height<0 || screenY>height)return;
    ctx.fillStyle=this.isBoost?'rgba(0,255,255,0.2)':'rgba(0,255,255,0.05)';
    ctx.fillRect(0,screenY,width,this.height);
  }
}

class Disc{
  constructor(){
    this.x=Math.random()*width;
    this.y=player.y-Math.random()*1000-200;
    this.radius=8;
  }
  draw(cameraX,cameraY,cameraZ){
    let screenX = this.x - cameraX;
    let screenY = this.y - cameraY - cameraZ;
    ctx.shadowBlur=10; ctx.shadowColor='white';
    ctx.fillStyle='white';
    ctx.beginPath();
    ctx.arc(screenX,screenY,this.radius,0,Math.PI*2);
    ctx.fill();
    ctx.shadowBlur=0;
  }
}

// --- Game Functions ---
function startGame(name,color){
  gameRunning=true;
  player=new Bike(width/2,height-100,color,name);
  bots=[];trails=[];tiles=[];discs=[];
  distance=0;score=0;
  for(let i=0;i<TILE_LOOKAHEAD;i++)tiles.push(new Tile('flat'));
  loop();
}

function generateTile(){
  let types=['flat','rampUp','rampDown','curveLeft','curveRight'];
  let type=types[Math.floor(Math.random()*types.length)];
  tiles.push(new Tile(type));
  if(Math.random()<0.3)discs.push(new Disc());
}

function update(){
  if(!player.alive)return;

  player.move();
  bots.forEach(b=>b.move());

  // Collect discs
  discs.forEach((d,i)=>{
    if(Math.abs(player.x-d.x)<20 && Math.abs(player.y-d.y)<20){player.ammo++;discs.splice(i,1);}
  });

  // Distance & score
  distance+=PLAYER_SPEED;
  score=Math.floor(distance/10);

  // Generate new tiles
  if(tiles.length<TILE_LOOKAHEAD)generateTile();
}

function draw(){
  ctx.clearRect(0,0,width,height);

  // Camera
  let cameraX = player.x - width/2;
  let cameraY = player.y - height*0.6;
  let cameraZ = player.z*0.5;

  // Draw tiles
  tiles.forEach(t=>t.draw(cameraY,cameraZ));

  // Draw trails
  trails.forEach(t=>{
    let screenX = t.x - cameraX;
    let screenY = t.y - cameraY - t.z + cameraZ;
    ctx.fillStyle=t.color;
    ctx.fillRect(screenX-2,screenY-2,4,4);
  });

  // Draw discs
  discs.forEach(d=>d.draw(cameraX,cameraY,cameraZ));

  // Draw bikes
  if(player)player.draw(cameraX,cameraY,cameraZ);
  bots.forEach(b=>b.draw(cameraX,cameraY,cameraZ));

  hud.innerText=`Score: ${score} | Ammo: ${player?player.ammo:0}`;
}

function loop(){
  if(!gameRunning)return;
  requestAnimationFrame(loop);
  update();
  draw();
}

// --- Input ---
document.addEventListener('keydown',e=>{
  if(e.key==='w')keys.w=true;
  if(e.key==='a')keys.a=true;
  if(e.key==='s')keys.s=true;
  if(e.key==='d')keys.d=true;
  if(e.key===' ')keys.space=true;
});
document.addEventListener('keyup',e=>{
  if(e.key==='w')keys.w=false;
  if(e.key==='a')keys.a=false;
  if(e.key==='s')keys.s=false;
  if(e.key==='d')keys.d=false;
  if(e.key===' ')keys.space=false;
});

// --- Start button ---
const startBtn=document.getElementById('startBtn');
startBtn.addEventListener('click',()=>{
  const name=document.getElementById('playerName').value||'Runner';
  const color=document.getElementById('bikeColor').value||'cyan';
  document.getElementById('menu').style.display='none';
  startGame(name,color);
});

window.addEventListener('resize',()=>{width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;});
</script>
</body>
</html>
